#!/bin/sh
# ver=1.0.0
# created by dev_null
#
# the next line is a reminder in the syslog that credentials have not been set up - comment out this line once credential have been entered
logger -s -t vnstat-email vnstat email setup not completed - check send-vnstat and update credentials
#
FROM="Router vnstat report"
AUTH="username@gmail.com"
PASS="userpassword"
TO="recepient@gmail.com"
SUBJECT="VNSTAT report"
FRIENDLY_ROUTER_NAME=Your router friendly name

makemime /home/root/vnstat.txt
# makemime -c "image/png" -a "Content-Disposition: attachment" -o /home/root/summary3.png /home/root/summary3.png
makemime -a"Subject: $FRIENDLY_ROUTER_NAME vnstat Stats at $(date +"%H.%M on %F")" -a"From: $FROM" -o /home/root/output.msg /home/root/vnstat.txt

cat /home/root/output.msg | sendmail -H"exec openssl s_client -quiet \
-CAfile /jffs/configs/Equifax_Secure_Certificate_Authority.pem \
-connect smtp.gmail.com:587 -tls1 -starttls smtp" \
-f"$FROM" \
-au"$AUTH" -ap"$PASS" $TO

logger -s -t vnstat-email vnstat email complete

# optional save of message
# cp -a /home/root/vnstat.txt "/tmp/mnt/your_drive_path/Traffic/vnstat-$(date +"%F_%H.%M").txt" # edit the path to your Traffic folder
rm  /home/root/vnstat.txt
